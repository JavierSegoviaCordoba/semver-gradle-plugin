


<!DOCTYPE html>
<html id="htmlId">
<head>
  <title>Coverage Report > GitRefGitExtensionsKt</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">com.javiersc.semver.project.gradle.plugin.internal.git</a>
</div>

<h1>Coverage Summary for Class: GitRefGitExtensionsKt (com.javiersc.semver.project.gradle.plugin.internal.git)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Branch, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
<th class="coverageStat 
">
  Instruction, %
</th>
</tr>
<tr>
  <td class="name">GitRefGitExtensionsKt</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (31/31)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    85%
  </span>
  <span class="absValue">
    (17/20)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (67/67)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (468/468)
  </span>
</td>
</tr>
  <tr>
    <td class="name">GitRefGitExtensionsKt$versionTagsInCurrentBranchSortedByTimelineOrSemverOrder$$inlined$sortedByDescending$1</td>
    <td class="coverageStat"/>
  </tr>
  <tr>
    <td class="name">GitRefGitExtensionsKt$versionTagsSortedBySemver$$inlined$sortedBy$1</td>
    <td class="coverageStat"/>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (31/31)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    85%
  </span>
  <span class="absValue">
    (17/20)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (67/67)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (468/468)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;package com.javiersc.semver.project.gradle.plugin.internal.git
&nbsp;
&nbsp;import com.javiersc.semver.Version
&nbsp;import org.eclipse.jgit.api.Git
&nbsp;import org.eclipse.jgit.lib.Constants
&nbsp;import org.eclipse.jgit.lib.ObjectId
&nbsp;import org.eclipse.jgit.lib.Ref
&nbsp;import org.eclipse.jgit.revwalk.RevCommit
&nbsp;import org.eclipse.jgit.revwalk.RevWalk
&nbsp;
&nbsp;internal val Git.headRef: Ref
<b class="fc">&nbsp;    get() = repository.findRef(repository.fullBranch)</b>
&nbsp;
&nbsp;// branches
&nbsp;internal val Git.currentBranch: GitRef.Branch
&nbsp;    get() =
<b class="fc">&nbsp;        repository.run {</b>
<b class="fc">&nbsp;            GitRef.Branch(branch, fullBranch, commitsInCurrentBranch, tagsInCurrentBranch)</b>
&nbsp;        }
&nbsp;
&nbsp;// commits
&nbsp;internal val Git.headCommit: GitRef.Head
&nbsp;    get() =
<b class="fc">&nbsp;        GitRef.Head(</b>
<b class="fc">&nbsp;            GitRef.Commit(</b>
<b class="fc">&nbsp;                message = headRevCommit.shortMessage,</b>
<b class="fc">&nbsp;                fullMessage = headRevCommit.fullMessage,</b>
<b class="fc">&nbsp;                hash = headRevCommit.toObjectId().name,</b>
&nbsp;            )
&nbsp;        )
&nbsp;
&nbsp;internal val Git.headRevCommit: RevCommit
<b class="fc">&nbsp;    get() = RevWalk(repository).parseCommit(repository.resolve(Constants.HEAD))</b>
&nbsp;
&nbsp;internal val Git.headRevCommitInBranch: RevCommit
<b class="fc">&nbsp;    get() = RevWalk(repository).parseCommit(headRef.objectId)</b>
&nbsp;
&nbsp;internal val Git.lastCommitInCurrentBranch: GitRef.Commit?
<b class="fc">&nbsp;    get() = commitsInCurrentBranch.firstOrNull()</b>
&nbsp;
&nbsp;internal val Git.commitsInCurrentBranchRevCommit: List&lt;RevCommit&gt;
<b class="fc">&nbsp;    get() = log().call().toList()</b>
&nbsp;
&nbsp;internal val Git.commitsInCurrentBranch: List&lt;GitRef.Commit&gt;
&nbsp;    get() =
<b class="fc">&nbsp;        commitsInCurrentBranchRevCommit.map { revCommit -&gt;</b>
<b class="fc">&nbsp;            revCommit.run {</b>
<b class="fc">&nbsp;                GitRef.Commit(</b>
<b class="fc">&nbsp;                    message = shortMessage,</b>
<b class="fc">&nbsp;                    fullMessage = fullMessage,</b>
<b class="fc">&nbsp;                    hash = toObjectId().name,</b>
&nbsp;                )
&nbsp;            }
&nbsp;        }
&nbsp;
&nbsp;internal val Git.commitsInCurrentBranchHash: List&lt;String&gt;
<b class="fc">&nbsp;    get() = commitsInCurrentBranchRevCommit.map(RevCommit::getName)</b>
&nbsp;
<b class="fc">&nbsp;internal fun Git.commitHash(ref: Ref): String = commitHash(ref.objectId)</b>
&nbsp;
&nbsp;internal fun Git.commitHash(objectId: ObjectId): String =
<b class="fc">&nbsp;    repository.parseCommit(objectId).toObjectId().name</b>
&nbsp;
&nbsp;internal fun commitsBetweenTwoCommitsIncludingLastExcludingFirst(
&nbsp;    fromCommit: String?,
&nbsp;    toCommit: String?,
&nbsp;    commitsInCurrentBranch: List&lt;String&gt;,
&nbsp;): List&lt;String&gt; {
<b class="fc">&nbsp;    val to: Int = commitsInCurrentBranch.indexOf(toCommit)</b>
<b class="fc">&nbsp;    val from: Int = commitsInCurrentBranch.indexOf(fromCommit)</b>
&nbsp;
<b class="fc">&nbsp;    return when {</b>
<b class="pc">&nbsp;        (to == -1 || from == -1) -&gt; emptyList()</b>
<b class="fc">&nbsp;        to &gt; from -&gt; commitsInCurrentBranch.subList(from, to)</b>
<b class="fc">&nbsp;        else -&gt; commitsInCurrentBranch.subList(to, from)</b>
&nbsp;    }
&nbsp;}
&nbsp;
&nbsp;internal val Git.commitsInCurrentBranchFullMessage: List&lt;String&gt;
<b class="fc">&nbsp;    get() = commitsInCurrentBranchRevCommit.map(RevCommit::getFullMessage)</b>
&nbsp;
&nbsp;internal fun Git.lastVersionCommitInCurrentBranch(tagPrefix: String): GitRef.Commit? =
<b class="fc">&nbsp;    lastVersionTagInCurrentBranch(tagPrefix)?.commit</b>
&nbsp;
&nbsp;// tags
&nbsp;internal val Ref.tagName: String
<b class="fc">&nbsp;    get() = name.substringAfter(&quot;refs/tags/&quot;)</b>
&nbsp;
&nbsp;internal val Git.tagsInRepo: List&lt;GitRef.Tag&gt;
&nbsp;    get() =
<b class="fc">&nbsp;        tagsInRepoRef.map { ref -&gt;</b>
<b class="fc">&nbsp;            val commit = repository.parseCommit(ref.objectId)</b>
<b class="fc">&nbsp;            GitRef.Tag(</b>
<b class="fc">&nbsp;                name = ref.tagName,</b>
<b class="fc">&nbsp;                refName = ref.name,</b>
&nbsp;                commit =
<b class="fc">&nbsp;                    GitRef.Commit(</b>
<b class="fc">&nbsp;                        message = commit.shortMessage,</b>
<b class="fc">&nbsp;                        fullMessage = commit.fullMessage,</b>
<b class="fc">&nbsp;                        hash = commit.toObjectId().name,</b>
&nbsp;                    )
&nbsp;            )
&nbsp;        }
&nbsp;
&nbsp;internal val Git.tagsInRepoRef: List&lt;Ref&gt;
<b class="fc">&nbsp;    get() = Git(repository).tagList().call()</b>
&nbsp;
&nbsp;internal val Git.tagsInRepoHash: List&lt;String&gt;
<b class="fc">&nbsp;    get() = tagsInRepoRef.map(::commitHash)</b>
&nbsp;
&nbsp;internal val Git.tagsInRepoName: List&lt;String&gt;
<b class="fc">&nbsp;    get() = tagsInRepoRef.map(Ref::getName)</b>
&nbsp;
&nbsp;internal val Git.tagsInCurrentBranch: List&lt;GitRef.Tag&gt;
&nbsp;    get() =
<b class="fc">&nbsp;        tagsInCurrentBranchRef.map { ref -&gt;</b>
<b class="fc">&nbsp;            val commit = repository.parseCommit(ref.objectId)</b>
<b class="fc">&nbsp;            GitRef.Tag(</b>
<b class="fc">&nbsp;                name = ref.tagName,</b>
<b class="fc">&nbsp;                refName = ref.name,</b>
&nbsp;                commit =
<b class="fc">&nbsp;                    GitRef.Commit(</b>
<b class="fc">&nbsp;                        message = commit.shortMessage,</b>
<b class="fc">&nbsp;                        fullMessage = commit.fullMessage,</b>
<b class="fc">&nbsp;                        hash = commit.toObjectId().name,</b>
&nbsp;                    )
&nbsp;            )
&nbsp;        }
&nbsp;
&nbsp;internal val Git.tagsInCurrentBranchRef: List&lt;Ref&gt;
<b class="fc">&nbsp;    get() = tagsInRepoRef.filter { ref -&gt; commitHash(ref) in commitsInCurrentBranchHash }</b>
&nbsp;
&nbsp;internal val Git.tagsInCurrentBranchHash: List&lt;String&gt;
<b class="fc">&nbsp;    get() = tagsInCurrentBranchRef.map(::commitHash)</b>
&nbsp;
&nbsp;internal val Git.tagsInCurrentBranchName: List&lt;String&gt;
<b class="fc">&nbsp;    get() = tagsInCurrentBranchRef.map(Ref::getName)</b>
&nbsp;
&nbsp;internal fun Git.tagsInCurrentCommit(hash: String): List&lt;GitRef.Tag&gt; =
<b class="fc">&nbsp;    tagsInCurrentBranch.filter { it.commit.hash == hash }</b>
&nbsp;
&nbsp;internal fun Git.isThereVersionTag(tagPrefix: String): Boolean =
<b class="fc">&nbsp;    versionTagsInCurrentBranch(tagPrefix).isNotEmpty()</b>
&nbsp;
&nbsp;internal fun Git.versionTagsInCurrentCommit(hash: String, tagPrefix: String): List&lt;GitRef.Tag&gt; =
<b class="fc">&nbsp;    tagsInCurrentCommit(hash).filter { tag -&gt;</b>
<b class="fc">&nbsp;        tag.name.startsWith(tagPrefix) &amp;&amp; Version.safe(tag.name.removePrefix(tagPrefix)).isSuccess</b>
&nbsp;    }
&nbsp;
&nbsp;internal fun Git.versionTagsInCurrentBranch(tagPrefix: String): List&lt;GitRef.Tag&gt; =
<b class="fc">&nbsp;    tagsInCurrentBranch.filter { tag -&gt;</b>
<b class="fc">&nbsp;        tag.name.startsWith(tagPrefix) &amp;&amp; Version.safe(tag.name.removePrefix(tagPrefix)).isSuccess</b>
&nbsp;    }
&nbsp;
&nbsp;internal fun Git.versionTagsSortedBySemver(tagPrefix: String): List&lt;GitRef.Tag&gt; =
<b class="fc">&nbsp;    versionTagsInCurrentBranch(tagPrefix).sortedBy { tag -&gt;</b>
<b class="pc">&nbsp;        Version.safe(tag.name.removePrefix(tagPrefix)).getOrNull()</b>
&nbsp;    }
&nbsp;
&nbsp;internal fun Git.versionTagsInCurrentBranchSortedByTimelineOrSemverOrder(
&nbsp;    tagPrefix: String
&nbsp;): List&lt;GitRef.Tag&gt; {
<b class="fc">&nbsp;    val commitsByHash: Map&lt;String, Int&gt; =</b>
<b class="fc">&nbsp;        commitsInCurrentBranchHash.withIndex().associate { it.value to it.index }</b>
&nbsp;
<b class="fc">&nbsp;    return versionTagsSortedBySemver(tagPrefix).sortedByDescending { tag -&gt;</b>
<b class="fc">&nbsp;        commitsByHash[tag.commit.hash]</b>
&nbsp;    }
&nbsp;}
&nbsp;
&nbsp;internal fun Git.lastVersionTagInCurrentBranch(tagPrefix: String): GitRef.Tag? =
<b class="fc">&nbsp;    versionTagsInCurrentBranchSortedByTimelineOrSemverOrder(tagPrefix).lastOrNull()</b>
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2023-03-11 14:08</div>
</div>
</body>
</html>
